<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/_head :: common-head('메인')"></head>
<body>
<div th:replace="fragments/_nav :: navbar"></div>

<main class="container py-6">
  <section class="card">
    <h1 class="h1">사용자 목록</h1>
    <p class="muted">/users API에서 가져온 데이터를 렌더링합니다.</p>

    <div id="users-empty" class="muted" style="display:none">등록된 사용자가 없습니다.</div>
    <div class="table-wrapper">
      <table id="users-table" class="table" aria-label="사용자 목록">
        <thead>
        <tr>
          <th>ID</th>
          <th>이름</th>
          <th>전화번호</th>
          <th>로그인ID</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<script th:src="@{/js/app.js}"></script>
<script>
  // 메인에서 사용자 목록 로드
  window.addEventListener('DOMContentLoaded', async () => {
    try {
      const res = await fetch('/users', { headers: { 'Accept': 'application/json' } });
      if (!res.ok) throw new Error('사용자 목록 조회 실패');
      const data = await res.json();
      const tbody = document.querySelector('#users-table tbody');
      tbody.innerHTML = '';
      if (!data || data.length === 0) {
        document.getElementById('users-empty').style.display = 'block';
        document.getElementById('users-table').style.display = 'none';
        return;
      }
      for (const u of data) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${u.id}</td>
          <td>${u.name ?? ''}</td>
          <td>${u.phone ?? ''}</td>
          <td>${u.loginId ?? ''}</td>
        `;
        tbody.appendChild(tr);
      }
    } catch (e) {
      console.error(e);
    }
  });
</script>
</body>
</html>